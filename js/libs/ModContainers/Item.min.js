!function(t){this.Item=ModContainer.extend({init:function(t){if(null===Item.meta_data)return console.log("pls init meta data"),null;this._super(),this.rarity=Item.RARITY.NORMAL,this.item_level=Item.MAX_ILVL,this.random_name="",this.entry=new GgpkEntry(t);var e=this.entry.getProp("InheritsFrom").split(/[\\/]/).pop();this.meta_data=MetaData.build(e,Item.meta_data)},addMod:function(t){return t instanceof Mod&&(t.isPrefix()&&this.prefixes().length<this.maxPrefixes()||t.isSuffix()&&this.suffixes().length<this.maxSuffixes()||t.isImplicit()&&this.implicits().length<this.maxImplicits())?this._super(t):!1},addTag:function(t){return-1===this.tags.indexOf(t)?(this.tags.push(t),!0):!1},removeTag:function(t){var e=this.tags.indexOf(t);return-1!==e?(this.tags=this.tags.splice(e,1),t):!1},getTags:function(){return $.unique(this._super().concat(this.meta_data.props.tags,this.entry.valueAsArray("TagsKeys")))},maxModsOfType:function(t){var e=+t.getProp("GenerationType");switch(e){case Mod.MOD_TYPE.PREFIX:return this.maxPrefixes();case Mod.MOD_TYPE.SUFFIX:return this.maxSuffixes();case Mod.MOD_TYPE.IMPLICIT:return this.maxImplicits()}return-1},maxPrefixes:function(){switch(this.rarity){case Item.RARITY.NORMAL:return 0;case Item.RARITY.MAGIC:return 1;case Item.RARITY.RARE:case Item.RARITY.SHOWCASE:return this.meta_data.isA("AbstractJewel")?2:3;case Item.RARITY.UNIQUE:return Number.POSITIVE_INFINITY}},maxSuffixes:function(){return this.maxPrefixes()},maxImplicits:function(){return 1},modDomainEquiv:function(){return this.meta_data.isA("AbstractJewel")?Mod.DOMAIN.JEWEL:this.meta_data.isA("AbstractFlask")?Mod.DOMAIN.FLASK:this.meta_data.isA("AbstractMap")?Mod.DOMAIN.MAP:Mod.DOMAIN.ITEM},inDomainOf:function(t){switch(t){case Mod.DOMAIN.MASTER:return this.inDomainOf(Mod.DOMAIN.ITEM);default:return t===this.modDomainEquiv()}},baseName:function(){return this.entry.getProp("Name")},itemName:function(){switch(this.rarity){case Item.RARITY.MAGIC:var t="";return this.prefixes().length&&(t+=this.prefixes()[0].getProp("Name")+" "),t+=this.baseName(),this.suffixes().length&&(t+=" "+this.suffixes()[0].getProp("Name")),t;case Item.RARITY.RARE:return"Random Name + "+this.baseName()}return""},primary:function(){return+this.entry.getProp("Rows")},requirements:function(){var t={};return $.each({Level:this.entry.getProp("DropLevel"),Str:this.entry.getProp("ReqStr"),Dex:this.entry.getProp("ReqDex"),Int:this.entry.getProp("ReqInt")},function(e,a){a>0&&(t[e]=a)}),t},itemclassIdent:function(){var t=this;return $.map(Item.ITEMCLASSES,function(e,a){return+e.PRIMARY===+t.entry.getProp("ItemClass")?a:null})[0]},rarityIdent:function(){var t=this;return $.map(Item.RARITY,function(e,a){return e===+t.rarity?a.toLowerCase():null})[0]},stats:function(){var t={};return $.each($.map(this.mods,function(t){return t.statsJoined()}),function(e,a){var i=a.getProp("Id");t[i]?t[i].values.add(a.values):t[i]=a}),t},localStats:function(){var t=this.stats(),e={};if(this.meta_data.isA("AbstractWeapon"))$.each({physical:new ValueRange(+this.entry.getProp("DamageMin"),+this.entry.getProp("DamageMax")),fire:new ValueRange(0,0),cold:new ValueRange(0,0),lightning:new ValueRange(0,0),chaos:new ValueRange(0,0)},function(a,i){t["local_minimum_added_"+a+"_damage"]&&(i.min=t["local_minimum_added_"+a+"_damage"].values.add(i.min)),t["local_maximum_added_"+a+"_damage"]&&(i.max=t["local_maximum_added_"+a+"_damage"].values.add(i.max)),i.isZero()||(e[a.ucfirst()+" Damage"]=i)}),e["Physical Damage"]=Item.applyStat(e["Physical Damage"],t["local_physical_damage_+%"],0),e["Critical Strike Chance"]=Item.applyStat(+this.entry.getProp("Critical")/100,t["local_critical_strike_chance_+%"],2).toString()+"%",e["Attacks Per Second"]=Item.applyStat(1e3/+this.entry.getProp("Speed"),t["local_attack_speed_+%"],2);else if(this.meta_data.isA("AbstractArmour")){var a=this;$.each({Armour:"physical_damage_reduction",Evasion:"evasion",EnergyShield:"energy_shield"},function(i,n){e[i]=new ValueRange(+a.entry.getProp(i),+a.entry.getProp(i)),t["local_base_"+n+"_rating"]&&(e[i]=e[i].add(t["local_base_"+n+"_rating"].values)),e[i]=Item.applyStat(e[i],t["local_"+n+"_rating_+%"],0),e[i].isZero()&&delete e[i]})}return e}}),this.Item.applyStat=function(e,a,i){var n=null;if(a===t)n=e;else{var s=a.values.multiply(.01).add(1);n=e instanceof ValueRange?e.multiply(s):s.multiply(e)}return n.toFixed(i)},this.Item.meta_data=null,this.Item.RARITY={NORMAL:1,MAGIC:2,RARE:3,UNIQUE:4,SHOWCASE:5},this.Item.MAX_ILVL=100,this.Item.ITEMCLASSES={AMULET:{PRIMARY:5,TAGS:[3,0]},RING:{PRIMARY:6,TAGS:[2,0]},CLAW:{PRIMARY:7,TAGS:[14,81,8]},DAGGER:{PRIMARY:8,TAGS:[13,81,8]},WAND:{PRIMARY:9,TAGS:[9,81,8,32]},SWORD_1H:{PRIMARY:10,TAGS:[12,81,8]},THRUSTING_SWORD_1H:{PRIMARY:11,TAGS:[12,81,8]},AXE_1H:{PRIMARY:12,TAGS:[15,81,8]},MACE_1H:{PRIMARY:13,TAGS:[11,81,8]},BOW:{PRIMARY:14,TAGS:[5,82,8,32]},STAFF:{PRIMARY:15,TAGS:[10,82,8]},SWORD_2H:{PRIMARY:16,TAGS:[12,82,8]},AXE_2H:{PRIMARY:17,TAGS:[15,82,8]},MACE_2H:{PRIMARY:18,TAGS:[11,82,8]},QUIVER:{PRIMARY:21,TAGS:[21,0]},BELT:{PRIMARY:22,TAGS:[26,0]},GLOVES:{PRIMARY:23,TAGS:[22,7,0]},BOOTS:{PRIMARY:24,TAGS:[4,7,0]},ARMOUR:{PRIMARY:25,TAGS:[16,7,0]},HELMET:{PRIMARY:26,TAGS:[25,7,0]},SHIELD:{PRIMARY:27,TAGS:[1,7,0]},SCEPTRE:{PRIMARY:33,TAGS:[37,81,8]},MAP:{PRIMARY:36,TAGS:[0]},FISHING_ROD:{PRIMARY:38,TAGS:[80]},MAP_FRAGMENT:{PRIMARY:39,TAGS:[]},JEWEL:{PRIMARY:42,TAGS:[0]}}}();